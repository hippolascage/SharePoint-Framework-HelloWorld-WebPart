{"version":3,"sources":["TSLintTask.ts"],"names":[],"mappings":"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","file":"TSLintTask.js","sourcesContent":["import { GulpTask } from 'gulp-core-build';\nimport gulpType = require('gulp');\n/* tslint:disable:typedef */\nconst cached = require('gulp-cache');\n/* tslint:enable:typedef */\nimport through2 = require('through2');\nimport gutil = require('gulp-util');\nimport tslint = require('tslint');\nimport { merge } from 'lodash';\nimport md5 = require('md5');\nimport * as path from 'path';\nimport * as lintTypes from 'tslint/lib/lint';\nimport * as ts from 'typescript';\n\nexport interface ITSLintTaskConfig {\n  /* tslint:disable:no-any */\n  lintConfig?: any;\n  /* tslint:enable:no-any */\n  useOldConfig?: boolean; // TEMPORARY FLAG\n  rulesDirectory?: string | string[];\n  sourceMatch?: string[];\n  reporter?: (result: lintTypes.LintResult, file: gutil.File, options: ITSLintTaskConfig) => void;\n}\n\nexport class TSLintTask extends GulpTask<ITSLintTaskConfig> {\n  public name: string = 'tslint';\n  public taskConfig: ITSLintTaskConfig = {\n    // lintConfig: require('../lib/defaultTslint.json'),\n    lintConfig: {},\n    reporter: (result: lintTypes.LintResult, file: gutil.File, options: ITSLintTaskConfig): void => {\n      for (const failure of result.failures) {\n        const pathFromRoot: string = path.relative(this.buildConfig.rootPath, file.path);\n\n        const start: ts.LineAndCharacter = failure.getStartPosition().getLineAndCharacter();\n        this.fileError(\n          pathFromRoot,\n          start.line + 1,\n          start.character + 1,\n          failure.getRuleName(),\n          failure.getFailure());\n      }\n    },\n    rulesDirectory: ((): string[] => {\n      const msCustomRulesMain: string = require.resolve('tslint-microsoft-contrib');\n      const msCustomRulesDirectory: string = path.dirname(msCustomRulesMain);\n      return tslint.getRulesDirectories([ msCustomRulesDirectory ], __dirname);\n    })(),\n    sourceMatch: [\n      'src/**/*.ts',\n      'src/**/*.tsx'\n    ],\n    useOldConfig: false\n  };\n\n  /* tslint:disable:no-any */\n  private _lintRules: any = undefined;\n  /* tslint:enable:no-any */\n\n  public executeTask(gulp: gulpType.Gulp): NodeJS.ReadWriteStream {\n    const taskScope: TSLintTask = this;\n\n    return gulp.src(this.taskConfig.sourceMatch)\n      .pipe(cached(\n        through2.obj(function(\n          file: gutil.File,\n          encoding: string,\n          callback: (encoding?: string, file?: gutil.File) => void): void {\n          taskScope.logVerbose(file.path);\n\n          // Lint the file\n          if (file.isNull()) {\n            return callback(undefined, file);\n          }\n\n          // Stream is not supported\n          if (file.isStream()) {\n            this.emit('error', new gutil.PluginError(this.name, 'Streaming not supported'));\n            return callback();\n          }\n\n          const options: lintTypes.ILinterOptions = {\n            configuration: taskScope._loadLintRules(),\n            formatter: 'json',\n            formattersDirectory: undefined, // not used, use reporters instead\n            rulesDirectory: taskScope.taskConfig.rulesDirectory || []\n          };\n\n          const tslintOutput: tslint = new tslint(file.relative, file.contents.toString('utf8'), options);\n          /* tslint:disable:no-string-literal */\n          const result: lintTypes.LintResult = file['tslint'] = tslintOutput.lint();\n          /* tslint:enable:no-string-literal */\n\n          if (result.failureCount > 0) {\n            taskScope.taskConfig.reporter(result, file, taskScope.taskConfig);\n          }\n\n          this.push(file);\n          callback();\n        }), {\n          // Scope the cache to a combination of the lint rules and the build path\n          name: md5(\n            tslint.VERSION + JSON.stringify(taskScope._loadLintRules()) +\n            taskScope.name + taskScope.buildConfig.rootPath),\n          // What on the result indicates it was successful\n          success: (jshintedFile: gutil.File): boolean => {\n            /* tslint:disable:no-string-literal */\n            return jshintedFile['tslint'].failureCount === 0;\n            /* tslint:enable:no-string-literal */\n          },\n          // By default, the cache attempts to store the value of the objects in the stream\n          // For this task, this is over-engineering since we never need to store anything extra.\n          value: (file: gutil.File): Object => {\n            return {\n              path: file.path\n            };\n          }\n        }\n      ));\n  }\n  /* tslint:disable:no-any */\n  private _loadLintRules(): any {\n    if (!this._lintRules) {\n      const defaultConfig: any = this.taskConfig.useOldConfig\n  /* tslint:enable:no-any */\n        ? require('./defaultTslint_oldRules.json')\n        : require('./defaultTslint.json');\n      this._lintRules = merge(defaultConfig, this.taskConfig.lintConfig || {});\n    }\n    return this._lintRules;\n  }\n}\n"],"sourceRoot":"/source/"}
"use strict";
var SuiteNavManager_1 = require('../SuiteNavManager');
var ISuiteNavDataSource_1 = require('./ISuiteNavDataSource');
var sp_client_base_1 = require('@microsoft/sp-client-base');
var OnPremSuiteNavDataSource = (function () {
    /**
     * Initializes a new instance of the SuiteNavManagerConfiguration
     * @TODO Task 161973 Add PageContext and set the
     * webPermissionMask/suiteNavData.UserDisplayName/webServerRelativeUrl/currentUICultureName
     */
    function OnPremSuiteNavDataSource(httpClient, currentUICultureName, webServerRelativeUrl) {
        this.suiteNavService = ISuiteNavDataSource_1.SuiteNavSource.OnPrem;
        this._currentUICultureName = currentUICultureName;
        this._httpClient = httpClient;
        this._siteRelUrl = webServerRelativeUrl === '/' ? '' : webServerRelativeUrl;
    }
    // Downloads the OnPrem version of the SuiteNavData
    OnPremSuiteNavDataSource.prototype.loadData = function () {
        var _this = this;
        var url = this._siteRelUrl
            + '/_api/Microsoft.SharePoint.Portal.SuiteNavData.GetSuiteNavData?v=2&Locale='
            + this._currentUICultureName;
        return this._httpClient.get(url)
            .then(function (response) {
            if (response.status !== 200) {
                _this._logAndThrowSuiteNavLoadingError();
            }
            return response.json().then(function (jsonString) {
                if (jsonString.value === '') {
                    _this._logAndThrowSuiteNavLoadingError();
                }
                else {
                    var suiteNavResponse = JSON.parse(jsonString.value);
                    // If the height of the suiteNav is not provided, assume that it is 50px
                    if (!suiteNavResponse.NavBarData.Dimensions) {
                        suiteNavResponse.NavBarData.Dimensions = { Top: SuiteNavManager_1.default._defaultSuiteNavHeight };
                    }
                    return suiteNavResponse;
                }
            });
        });
    };
    OnPremSuiteNavDataSource.prototype._logAndThrowSuiteNavLoadingError = function () {
        sp_client_base_1._TraceLogger.logVerbose(OnPremSuiteNavDataSource._logSource, 'Failed to retrieve Hybrid SuiteNavData');
        throw new Error('Failed to retrieve Hybrid SuiteNavData');
    };
    // @TODO Bug 169685 change to readonly
    OnPremSuiteNavDataSource._logSource = sp_client_base_1._LogSource.create('OnPremSuiteNavDataSource');
    return OnPremSuiteNavDataSource;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = OnPremSuiteNavDataSource;

//# sourceMappingURL=OnPremSuiteNavDataSource.js.map

"use strict";
var LogSource_1 = require('./LogSource');
var LogManager_1 = require('./LogManager');
/**
 * An object that represents one log event.
 * @internal
 */
var LogEvent = (function () {
    /**
     * Do not call this constructor directly. Use LogEvent.log instead.
     */
    function LogEvent(source, data, level, serviceScope) {
        this._validate(source, data);
        this._scope = this._getScope(serviceScope);
        this._source = source.substr(0, this._maxSourceLength);
        this._setData(data);
        this._level = level;
    }
    /**
     * Use this method to log an event.
     *
     * @param source - source of the log event, e.g. class name of the source file
     * @param data - data of the log event
     * @param level - level of the log event
     * @param serviceScope - scope of the log event, e.g. component/web part
     */
    LogEvent.log = function (source, data, level, serviceScope) {
        var event = new LogEvent(source, data, level, serviceScope);
        LogManager_1.default.log(event);
        return event;
    };
    LogEvent.prototype.toString = function () {
        var prefix = "" + this._source;
        if (this._scope && !this._scope.isEmpty()) {
            prefix = this._scope.id.substr(0, this._maxSourceLength) + "." + prefix;
        }
        if (this._message) {
            return "[" + prefix + "] " + this._message;
        }
        else {
            return "[" + prefix + "] " + this._error.toString();
        }
    };
    Object.defineProperty(LogEvent.prototype, "_maxSourceLength", {
        get: function () {
            return 20;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LogEvent.prototype, "_maxMessageLength", {
        get: function () {
            return 100;
        },
        enumerable: true,
        configurable: true
    });
    LogEvent.prototype._validate = function (source, data) {
        if (!source) {
            throw new Error('source cannot be undefined or null for Logger');
        }
        if (!data) {
            throw new Error('data cannot be undefined or null');
        }
    };
    LogEvent.prototype._setData = function (data) {
        if (typeof data === 'string') {
            this._message = data.substr(0, this._maxMessageLength);
        }
        else if (data instanceof Error) {
            this._error = data;
        }
    };
    LogEvent.prototype._getScope = function (serviceScope) {
        var parentSource;
        if (serviceScope) {
            serviceScope.whenFinished(function () {
                parentSource = serviceScope.consume(LogSource_1.logSourceServiceKey);
            });
        }
        return parentSource;
    };
    return LogEvent;
}());
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = LogEvent;

//# sourceMappingURL=LogEvent.js.map

{"version":3,"sources":["WebpackTask.ts"],"names":[],"mappings":"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","file":"WebpackTask.js","sourcesContent":["import * as Webpack from 'webpack';\nimport { GulpTask } from 'gulp-core-build';\nimport gulp = require('gulp');\n\nexport interface IWebpackTaskConfig {\n  /**\n   * Path to a webpack config. A path to a config takes precidence over the \"config\" ooption.\n   */\n  configPath: string;\n\n  /**\n   * Webpack config object. If a path is specified by \"configPath,\" and it is valid, this option is ignored.\n   */\n  config?: Webpack.Configuration;\n\n  /**\n   * An array of regular expressions or regular expression strings. If a warning matches any of them, it\n   * will not be logged.\n   */\n  suppressWarnings?: (string | RegExp)[];\n}\n\nexport class WebpackTask extends GulpTask<IWebpackTaskConfig> {\n  public name = 'webpack';\n\n  public taskConfig: IWebpackTaskConfig = {\n    configPath: './webpack.config.js',\n    suppressWarnings: []\n  };\n\n  public resources = {\n    webpack: require('webpack')\n  };\n\n  public executeTask(gulp: gulp.Gulp, completeCallback: (result?: any) => void): void {\n    let shouldInitWebpack = (process.argv.indexOf('--initwebpack') > -1);\n    let path = require('path');\n\n    if (shouldInitWebpack) {\n      this.log(\n        'Initializing a webpack.config.js, which bundles lib/index.js ' +\n        'into dist/packagename.js into a UMD module.');\n\n      this.copyFile(path.resolve(__dirname, '..', 'webpack.config.js'));\n      completeCallback();\n    } else {\n      let webpackConfig = null;\n\n      if (!this.taskConfig.configPath && !this.taskConfig.config) {\n        this.logMissingConfigWarning();\n        completeCallback();\n        return;\n      } else if (this.taskConfig.configPath) {\n        if (this.fileExists(this.taskConfig.configPath)) {\n          try {\n            webpackConfig = require(this.resolvePath(this.taskConfig.configPath));\n          } catch (err) {\n            completeCallback(`Error parsing webpack config: ${ this.taskConfig.configPath }: ${ err }`);\n            return;\n          }\n        } else if (!this.taskConfig.config) {\n          let relativeConfigPath = path.relative(this.buildConfig.rootPath, this.taskConfig.config);\n\n          this.logWarning(\n            `The webpack config location '${relativeConfigPath}' doesn't exist. ` +\n            `Run again using --initwebpack to create a default config, or call ` +\n            `webpack.setConfig({ configPath: null }).`);\n\n          completeCallback();\n          return;\n        } else {\n          webpackConfig = this.taskConfig.config;\n        }\n      } else if (this.taskConfig.config) {\n        webpackConfig = this.taskConfig.config;\n      } else {\n        this.logMissingConfigWarning();\n        completeCallback();\n        return;\n      }\n\n      let webpack = require('webpack');\n      let gutil = require('gulp-util');\n      let startTime = new Date().getTime();\n      let outputDir = this.buildConfig.distFolder;\n\n      webpack(\n        webpackConfig,\n        (error, stats) => {\n          if (!this.buildConfig.properties) {\n            this.buildConfig.properties = {};\n          }\n\n          /* tslint:disable:no-string-literal */\n          this.buildConfig.properties['webpackStats'] = stats;\n          /* tslint:enable:no-string-literal */\n\n          let statsResult = stats.toJson({\n            hash: false,\n            source: false\n          });\n\n          if (statsResult.errors && statsResult.errors.length) {\n            this.logError(`'${outputDir}':` + '\\n' + statsResult.errors.join('\\n') + '\\n');\n          }\n\n          if (statsResult.warnings && statsResult.warnings.length) {\n            const unsuppressedWarnings: string[] = [];\n            const warningSuppressonRegexes = (this.taskConfig.suppressWarnings || []).map((regex: string) => {\n              return new RegExp(regex);\n            });\n\n            statsResult.warnings.forEach((warning: string) => {\n              let suppressed = false;\n              for (let i = 0; i < warningSuppressonRegexes.length; i++) {\n                const suppressionRegex = warningSuppressonRegexes[i];\n                if (warning.match(suppressionRegex)) {\n                  suppressed = true;\n                  break;\n                }\n              }\n\n              if (!suppressed) {\n                unsuppressedWarnings.push(warning);\n              }\n            });\n\n            if (unsuppressedWarnings.length > 0) {\n              this.logWarning(`'${outputDir}':` + '\\n' + unsuppressedWarnings.join('\\n') + '\\n');\n            }\n          }\n\n          let duration = (new Date().getTime() - startTime);\n          let statsResultChildren = statsResult.children ? statsResult.children : [ statsResult ];\n\n          statsResultChildren.forEach(child => {\n            child.chunks.forEach(chunk => {\n\n              chunk.files.forEach(file => (\n                this.log(`Bundled: '${gutil.colors.cyan(path.basename(file))}', ` +\n                  `size: ${gutil.colors.magenta(chunk.size)} bytes, ` +\n                  `took ${gutil.colors.magenta(duration)} ms.`)\n              )); // end file\n\n            }); // end chunk\n\n          }); // end child\n\n          completeCallback();\n        }); // endwebpack callback\n    }\n  }\n\n  private logMissingConfigWarning() {\n    this.logWarning(\n      'No webpack config has been provided.' +\n      'Run again using --initwebpack to create a default config,' +\n      `or call webpack.setConfig({ configPath: null }).`);\n  }\n}"],"sourceRoot":"/source/"}